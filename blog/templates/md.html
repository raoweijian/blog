{% extends "base.html" %}

{% block head %}
{{ block.super }}
<link rel="stylesheet" href="/static/css/github-markdown.css">
<link rel="stylesheet" href="/static/css/edit.css">
<script src='/static/js/showdown-1.8.6.min.js'></script>

{% include 'highlight.html' %}
{% endblock %}

{% block content %}
<div class='container' id="container">
    <div class="row">
        <div class="col-lg-12">
            <h1 style="text-align: center;">{{ title }}</h1>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                {% if user.is_authenticated %}
                <div class="col-lg-12">
                    <div style="float: right;">
                        <a class="btn btn-info btn-md" id="write_new" style="margin: 10px" href="{{ request.path }}/edit">编辑</a>
                    </div>
                </div>
                {% endif %}
                <div class="panel-body" id="content" v-html="content">
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
'use strict';

showdown.setOption('simpleLineBreaks', true);

let app = new Vue({
    el: '#container',
    data: {
        content: '',
        converter: new showdown.Converter(),
    },

    mounted: function(){
        let title = location.href.split('/').pop();
        let data = {};
        axios.get('/api/article/?title=' + title)
            .then((response) => {
                this.content = this.converter.makeHtml(response.data[0].content);
            })
            .catch((error) => {
                console.log(error);
            });
    },

    updated: function(){
        $('pre code').each(function(i, block){
            hljs.highlightBlock(block);
        });
    },
});

function escape2Html(str){
    var arrEntities = {'lt':'<', 'gt':'>', 'nbsp':' ', 'amp':'&', 'quot':'"'};
    return str.replace(/&(lt|gt|nbsp|amp|quot);/ig, function(all,t){return arrEntities[t];});
}
</script>
{% endblock %}
