#dubbo
**架构图：**
![图片](/static/images/blog/ts9C65ad.png)

调用关系说明： 
1. 服务容器负责启动，加载，运行服务提供者。 
2. 服务提供者在启动时，向注册中心注册自己提供的服务。 
3. 服务消费者在启动时，向注册中心订阅自己所需的服务。 
4. 注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。 
5. 服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。 
6. 服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。
7. 注册中心和监控中心全部宕机，不影响已运行的提供者和消费者，消费者在本地缓存了提供者列表

####问题1：注册中心用什么方法感知 provider 是否正常服务
注册中心通过长连接感知服务提供者的存在，服务提供者宕机，注册中心将立即推送事件通知消费者

####问题2：客户端获取服务列表以后，如果同一个服务有多个提供者，请求时怎么知道应该请求哪一个IP
服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。


####问题3：zookeeper 在 dubbo 中的角色是什么？
Dubbo的将注册中心进行抽象，使得它可以外接不同的存储媒介给注册中心提供服务，有ZooKeeper，Memcached，Redis等。

引入了ZooKeeper作为存储媒介，也就把ZooKeeper的特性引进来。首先是负载均衡，单注册中心的承载能力是有限的，在流量达到一定程度的时候就需要分流，负载均衡就是为了分流而存在的，一个ZooKeeper群配合相应的Web应用就可以很容易达到负载均衡；资源同步，单单有负载均衡还不够，节点之间的数据和资源需要同步，ZooKeeper集群就天然具备有这样的功能；命名服务，将树状结构用于维护全局的服务地址列表，服务提供者在启动的时候，向ZK上的指定节点/dubbo/${serviceName}/providers目录下写入自己的URL地址，这个操作就完成了服务的发布。其他特性还有 master 选举，分布式锁等。

####问题4：客户端跟注册中心是否需要保持长连接？
需要，因为 provider 有变更时，注册中心会把变更数据推送给消费者。